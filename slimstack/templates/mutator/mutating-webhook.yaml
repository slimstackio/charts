{{- if .Values.controller.enabled }}
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: {{ .Values.controller.mutator.name }}
webhooks:
  - name: mutator.slimstack.io
    clientConfig:
      service:
        name: {{ .Values.controller.mutator.name }}
        namespace: {{ .Release.Namespace }}
        path: "/mutate"
        port: 8443
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZMekNDQXhlZ0F3SUJBZ0lVV2dOK2ExOHBuVytyci9Kc2dLcmsyUXFJNUw4d0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tqRW9NQ1lHQTFVRUF3d2ZlVzkxY2kxM1pXSm9iMjlyTG5sdmRYSXRibUZ0WlhOd1lXTmxMbk4yWXpBZQpGdzB5TkRBNE1UUXhORFEyTlRaYUZ3MHpOREE0TVRJeE5EUTJOVFphTUNveEtEQW1CZ05WQkFNTUgzbHZkWEl0CmQyVmlhRzl2YXk1NWIzVnlMVzVoYldWemNHRmpaUzV6ZG1Nd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUMKRHdBd2dnSUtBb0lDQVFDVjFGZ29EYkxsc2ppMDVlSkJOZkJXSW5wK1NzQTVLY3k4RnY4dEpsQ2p5dDNoTmxrcApTSDArQ3FrTDBWQUg0QXlFcEpkVjRXU2IxZjlUWkxtWmFuZXhHbW8vZk5kd2c4akF4QUtaamk0UGE4SWlFenlvCmo5cUdsRy91MFE4UEJpS0FsVkJ0bkFoUzRPMU11Vk5lVjhEYzBGV1RDdEM2NDVDWllqZHBTSDBVODFVWVhxWm4KeWxUUHRKbjZyZ3dWd3JwSzMwN2hYUWxneUdKMTJLc04zYkFnblByT3lsVzVkUTBGLzhlci9kdUZqckNNSkh3MgpQSHFUT01RNkh3TlFIL1ZxQmcrNjIxQTVlVnhCVUVIL3ZramhTb0xvZXdQZzJNc1lTMmNmNHJhTXY5QTVGNXQxClpzaUd4dkhCZW9mcFdLdDBQNzJVWG9rQ2JEamgxVDRUT3JRRlFJY3orNmUwN3UrMzFSL2NOQWkxY0JkWHhHanIKRXNCUmhwMGNsWEUxc1V6UWFjd2tJbFY3U2MyMno2eThaT05jVFJmeitQT1JhZmFERU5CRjJRUHY2Y1hSU05LbwpWcnkzNGhseHV1RWRFTFBHbHBIdnRLdFFOK0tnWWkveTZwRUpLTlh2bXcyalFRejdsd1o1UW1UZXhHNG1FZXkzCkxvR0NiYndHektOTWtRN2hySGNoSmhjdXNNa0tVTERNa0hsdjJKRGM5ZTlHMlV0MXpaQ3NscjloTEo5S045VFIKNk9xeDgzTXBrODhEVk9MRHV6NVlxZVdLS1dWbG5GQnYvcnVQUkd3SHpzR2h4eTNsOHZzMEcrcDRvOGtydXJwTQpYd0NsdHhrYllmK3A2RzMvWWluY2szcmNqVGxWV25uQlR2ZlpNczcyTm9qSmc0TGlOZWRJRm5VVVR3SURBUUFCCm8wMHdTekFxQmdOVkhSRUVJekFoZ2g5emJHbHRjM1JoWTJzdGJYVjBZWFJ2Y2k1emJHbHRjM1JoWTJzdWMzWmoKTUIwR0ExVWREZ1FXQkJSWTU2RUZCMFhYOGFqSGFkekRFb2cyOU1qczJqQU5CZ2txaGtpRzl3MEJBUXNGQUFPQwpBZ0VBS29OUHI1VDBNT1JGMWNIY3J0RU01WmxzUTg2bU9rMWlvTGZYNTJtaFRKN1ErU0dvMmJHNEl6OVZ5aWNqCmI0Sld6cFpaZ1h1WFRVd0V6Ni9uZGswWjhRamdmL1N4MkdpSmxKbzNQRWpwZUNYUUtHRCtBZXJlTUpkUEw2dWYKMytkOG5HL0NnWGx1SkdDOHdnZGhnaHQvRCtYY2NIRTVzZlRWVGdBQ0JPRjdvWlU2djU5K1U3Q242azg1YStMeAprNkx0bGdlRWdSdkJwWTlhaFFCemM0TGdHY1gwM1FXODFIVHMzdkc1MXc3cGtqYlJKMlZ3TTJkYThuU3lDUUxkCkRJajlscHNEQzNEWk5ZSmpKTVA2NFFFV1g0Z05jazRwMi84aldrbkM2SkZSd3hVNTZPVFJ3cnR5dkNNLzFIOGkKZ05ZbmdxdFUzRHlSdWhxSUxEd3drbWZJNjJHc3lIZC8raWdEUjNBeU9DVnFGUlBrcTZJTmluUUd3M2M1UkZkWgowTXZsaWRqSTcyY2dwMlFtTkJSVjhVOGJjTUovMlorZm1vYTZBaXROaDkxQnUyaG5BYkRiSmFOdCtncktyZTVqCk9vbEluek9RTGtmQWxSVFpFUHI1clliTEcwdUhLMTFjUmFia3Z6dUtiSXBTNWhNSlJCcnZFZU1ldjNMclYzWk8KUEJZa1k5Mk5idDRjUWVjZHltbjdDL3JqSjZZMC9OTG5OUDZTa2xyQzdzSGc3Z0dtcHRsNEY4NWhNMXA5aHRGaApiT3I4Tk84V2RQRXZWaDd5bVV4bXUxTWluS3dHaW9CY0dVeUp5Q2FMbVpxaG9GcFhhY1l2QmZwbzgrSlRmOUwzCmZpR2Y1RjdIT3NIb0pNTlNQREZNc0UzaVd4UEQ0cnhSbFhGc3hqZVBBVlU2T1NjPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    failurePolicy: Ignore
    sideEffects: None
    timeoutSeconds: 5
    admissionReviewVersions: ["v1", "v1beta1"]
{{- end }}
